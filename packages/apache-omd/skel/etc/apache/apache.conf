###############################################################################
# Apache configuration file for OMD site specific webserver daemon
###############################################################################
# FIXME: Could be reorganized and cleaned up a bit.

ServerRoot "###ROOT###"
PidFile ###ROOT###/tmp/apache/run/apache.pid
Timeout 120
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 15

# FIXME: Dynamic port (Site specific one)
Listen 1337

##
## Server-Pool Size Regulation (MPM specific)
## 

# prefork MPM
# StartServers: number of server processes to start
# MinSpareServers: minimum number of server processes which are kept spare
# MaxSpareServers: maximum number of server processes which are kept spare
# ServerLimit: maximum value for MaxClients for the lifetime of the server
# MaxClients: maximum number of server processes allowed to start
# MaxRequestsPerChild: maximum number of requests a server process serves
<IfModule prefork.c>
StartServers         1
MinSpareServers      1
MaxSpareServers      5
ServerLimit          20
MaxClients           256
MaxRequestsPerChild  4000
</IfModule>

# worker MPM
# StartServers: initial number of server processes to start
# MaxClients: maximum number of simultaneous client connections
# MinSpareThreads: minimum number of worker threads which are kept spare
# MaxSpareThreads: maximum number of worker threads which are kept spare
# ThreadsPerChild: constant number of worker threads in each server process
# MaxRequestsPerChild: maximum number of requests a server process serves
<IfModule worker.c>
StartServers         2
MaxClients           150
MinSpareThreads      25
MaxSpareThreads      75 
ThreadsPerChild      25
MaxRequestsPerChild  0
</IfModule>

# Load Modules
LoadModule auth_basic_module ###APACHE_MODULE_DIR###/mod_auth_basic.so
LoadModule auth_digest_module ###APACHE_MODULE_DIR###/mod_auth_digest.so
LoadModule authn_file_module ###APACHE_MODULE_DIR###/mod_authn_file.so
LoadModule authn_alias_module ###APACHE_MODULE_DIR###/mod_authn_alias.so
LoadModule authn_anon_module ###APACHE_MODULE_DIR###/mod_authn_anon.so
LoadModule authn_dbm_module ###APACHE_MODULE_DIR###/mod_authn_dbm.so
LoadModule authn_default_module ###APACHE_MODULE_DIR###/mod_authn_default.so
LoadModule authz_host_module ###APACHE_MODULE_DIR###/mod_authz_host.so
LoadModule authz_user_module ###APACHE_MODULE_DIR###/mod_authz_user.so
LoadModule authz_owner_module ###APACHE_MODULE_DIR###/mod_authz_owner.so
LoadModule authz_groupfile_module ###APACHE_MODULE_DIR###/mod_authz_groupfile.so
LoadModule authz_dbm_module ###APACHE_MODULE_DIR###/mod_authz_dbm.so
LoadModule authz_default_module ###APACHE_MODULE_DIR###/mod_authz_default.so
LoadModule ldap_module ###APACHE_MODULE_DIR###/mod_ldap.so
LoadModule authnz_ldap_module ###APACHE_MODULE_DIR###/mod_authnz_ldap.so
LoadModule include_module ###APACHE_MODULE_DIR###/mod_include.so
LoadModule log_config_module ###APACHE_MODULE_DIR###/mod_log_config.so
LoadModule logio_module ###APACHE_MODULE_DIR###/mod_logio.so
LoadModule env_module ###APACHE_MODULE_DIR###/mod_env.so
LoadModule ext_filter_module ###APACHE_MODULE_DIR###/mod_ext_filter.so
LoadModule mime_magic_module ###APACHE_MODULE_DIR###/mod_mime_magic.so
LoadModule expires_module ###APACHE_MODULE_DIR###/mod_expires.so
LoadModule deflate_module ###APACHE_MODULE_DIR###/mod_deflate.so
LoadModule headers_module ###APACHE_MODULE_DIR###/mod_headers.so
LoadModule usertrack_module ###APACHE_MODULE_DIR###/mod_usertrack.so
LoadModule setenvif_module ###APACHE_MODULE_DIR###/mod_setenvif.so
LoadModule mime_module ###APACHE_MODULE_DIR###/mod_mime.so
LoadModule status_module ###APACHE_MODULE_DIR###/mod_status.so
LoadModule autoindex_module ###APACHE_MODULE_DIR###/mod_autoindex.so
LoadModule info_module ###APACHE_MODULE_DIR###/mod_info.so
LoadModule vhost_alias_module ###APACHE_MODULE_DIR###/mod_vhost_alias.so
LoadModule negotiation_module ###APACHE_MODULE_DIR###/mod_negotiation.so
LoadModule dir_module ###APACHE_MODULE_DIR###/mod_dir.so
LoadModule actions_module ###APACHE_MODULE_DIR###/mod_actions.so
LoadModule speling_module ###APACHE_MODULE_DIR###/mod_speling.so
LoadModule alias_module ###APACHE_MODULE_DIR###/mod_alias.so
LoadModule rewrite_module ###APACHE_MODULE_DIR###/mod_rewrite.so
LoadModule proxy_module ###APACHE_MODULE_DIR###/mod_proxy.so
LoadModule proxy_balancer_module ###APACHE_MODULE_DIR###/mod_proxy_balancer.so
LoadModule proxy_ftp_module ###APACHE_MODULE_DIR###/mod_proxy_ftp.so
LoadModule proxy_http_module ###APACHE_MODULE_DIR###/mod_proxy_http.so
LoadModule proxy_connect_module ###APACHE_MODULE_DIR###/mod_proxy_connect.so
LoadModule cache_module ###APACHE_MODULE_DIR###/mod_cache.so
LoadModule suexec_module ###APACHE_MODULE_DIR###/mod_suexec.so
LoadModule disk_cache_module ###APACHE_MODULE_DIR###/mod_disk_cache.so
LoadModule file_cache_module ###APACHE_MODULE_DIR###/mod_file_cache.so
LoadModule mem_cache_module ###APACHE_MODULE_DIR###/mod_mem_cache.so
LoadModule cgi_module ###APACHE_MODULE_DIR###/mod_cgi.so
LoadModule version_module ###APACHE_MODULE_DIR###/mod_version.so
LoadModule php5_module ###APACHE_MODULE_DIR###/libphp5.so

# Load config files from the include dir
Include ###ROOT###/etc/apache/conf.d/*.conf

# User/Group to run the webserver with
User ###SITE###
Group ###SITE###

ServerAdmin ###SITE###@localhost
#ServerName www.example.com:80
UseCanonicalName Off

DocumentRoot "###ROOT###/var/www"

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>

DirectoryIndex index.html index.php index.html.var
AccessFileName .htaccess
ServerTokens OS
HostnameLookups Off
ServerSignature Off

#
# The following lines prevent .htaccess and .htpasswd files from being 
# viewed by Web clients. 
#
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>

TypesConfig /etc/mime.types
DefaultType text/plain

<IfModule mod_mime_magic.c>
    MIMEMagicFile ###ROOT###/etc/apache/magic
</IfModule>

ErrorLog ###ROOT###/var/log/apache/error_log
LogLevel warn

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog ###ROOT###/var/log/apache/access_log combined

#
# Generated Directory Index config
#

IndexOptions FancyIndexing VersionSort NameWidth=* HTMLTable

ReadmeName README.html
HeaderName HEADER.html
IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t

#
# Language configuration
#

AddLanguage ca .ca
AddLanguage cs .cz .cs
AddLanguage da .dk
AddLanguage de .de
AddLanguage el .el
AddLanguage en .en
AddLanguage eo .eo
AddLanguage es .es
AddLanguage et .et
AddLanguage fr .fr
AddLanguage he .he
AddLanguage hr .hr
AddLanguage it .it
AddLanguage ja .ja
AddLanguage ko .ko
AddLanguage ltz .ltz
AddLanguage nl .nl
AddLanguage nn .nn
AddLanguage no .no
AddLanguage pl .po
AddLanguage pt .pt
AddLanguage pt-BR .pt-br
AddLanguage ru .ru
AddLanguage sv .sv
AddLanguage zh-CN .zh-cn
AddLanguage zh-TW .zh-tw

LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv zh-CN zh-TW
ForceLanguagePriority Prefer Fallback

AddDefaultCharset UTF-8

AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz

AddHandler type-map var

AddHandler php5-script .php
AddType text/html .php

#
# The following directives modify normal HTTP response behavior to
# handle known problems with browser implementations.
#
BrowserMatch "Mozilla/2" nokeepalive
BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
BrowserMatch "RealPlayer 4\.0" force-response-1.0
BrowserMatch "Java/1\.0" force-response-1.0
BrowserMatch "JDK/1\.0" force-response-1.0

#
# The following directive disables redirects on non-GET requests for
# a directory that does not include the trailing slash.  This fixes a 
# problem with Microsoft WebFolders which does not appropriately handle 
# redirects for folders with DAV methods.
# Same deal with Apple's DAV filesystem and Gnome VFS support for DAV.
#
BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
BrowserMatch "MS FrontPage" redirect-carefully
BrowserMatch "^WebDrive" redirect-carefully
BrowserMatch "^WebDAVFS/1.[0123]" redirect-carefully
BrowserMatch "^gnome-vfs/1.0" redirect-carefully
BrowserMatch "^XML Spy" redirect-carefully
BrowserMatch "^Dreamweaver-WebDAV-SCM1" redirect-carefully
