#!/bin/sh
### BEGIN INIT INFO
# Provides:          nsca
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
### END INIT INFO

. ###ROOT###/etc/omd/site.conf
if [ "$CONFIG_NSCA" != on ] ; then
    exit 5
fi
# postponed until shinken's native nsca daemon can be used
#if [ "$CONFIG_CORE" = "shinken" ] ; then
#    # Shinken has it's own nsca listener
#    exit 5
#fi


DAEMON=###ROOT###/bin/nsca
NAME=nsca
USER=###SITE###
DESC="Nagios Service Check Acceptor"
CONF=###ROOT###/etc/nsca/nsca.cfg
OPTS="-c $CONF"
PIDFILE="###ROOT###/tmp/run/nsca.pid"

###
# obviously if the daemon doesn't exist we should stop now
if [ ! -x $DAEMON ]; then
    exit 1
fi

die(){
    echo $@
    exit 1
}

case "$1" in
start)
    echo -n "Starting $DESC: "
    $DAEMON $OPTS || die "ERROR: could not start $NAME."
    echo "$NAME."
    exit 0
;;
stop)
    echo -n "Stopping $DESC: "
    kill $(cat $PIDFILE) || die "ERROR: could not stop $NAME."
    rm -f $PIDFILE
    echo "$NAME."
    exit 0
;;
reload|force-reload)
    echo -n "Reloading $DESC: "
    kill -HUP $(cat $PIDFILE) || die "ERROR: could not reload $NAME."
    echo "$NAME."
    exit 0
;;
restart)
    $0 stop
    $0 start
    exit 0
;;
status)
    echo -n 'Checking status of $NAME...'
    if [ -e "$PIDFILE" ] ; then
        PID=$(cat $PIDFILE)
        if [ -n "$PID" ] && ps $PID > /dev/null 2>&1 ; then
            echo "running"
            exit 0
        fi
    fi
    echo "stopped"
    exit 1
;;
esac
