From a99dfd0b8b883c042b7f43cbb699c3bc06c67953 Mon Sep 17 00:00:00 2001
From: Michael Friedrich <michael.friedrich@univie.ac.at>
Date: Wed, 8 Jun 2011 12:51:35 +0200
Subject: [PATCH] fix xss vulnerability in config/statusmap.cgi trackerids #207 #224

---
 cgi/config.c    |    2 +-
 cgi/statusmap.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/cgi/config.c b/cgi/config.c
index 8f5b0a4..5d8aa90 100644
--- a/cgi/config.c
+++ b/cgi/config.c
@@ -426,7 +426,7 @@ int process_cgivars(void){
 				error=TRUE;
 				break;
 			        }
-			strncpy(to_expand,variables[x],MAX_COMMAND_BUFFER);
+			strncpy(to_expand,escape_string(variables[x]),MAX_COMMAND_BUFFER);
 			to_expand[MAX_COMMAND_BUFFER-1]='\0';
 		        }
 
diff --git a/cgi/statusmap.c b/cgi/statusmap.c
index a77352d..7f8bc3f 100644
--- a/cgi/statusmap.c
+++ b/cgi/statusmap.c
@@ -2404,7 +2404,7 @@ void print_layer_url(int get_method){
 
 	for(temp_layer=layer_list;temp_layer!=NULL;temp_layer=temp_layer->next){
 		if(get_method==TRUE)
-			printf("&layer=%s",temp_layer->layer_name);
+			printf("&layer=%s",escape_string(temp_layer->layer_name));
 		else
 			printf("<input type='hidden' name='layer' value='%s'>\n",escape_string(temp_layer->layer_name));
 	        }
-- 
1.7.1.1

