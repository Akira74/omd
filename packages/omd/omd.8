.\"                                      Hey, EMACS: -*- nroff -*-
.\" First parameter, NAME, should be all caps
.\" Second parameter, SECTION, should be 1-8, maybe w/ subsection
.\" other parameters are allowed: see man(7), man(1)
.TH OMD 8 "August  7, 2010"
.\" Please adjust this date whenever revising the manpage.
.\"
.\" Some roff macros, for reference:
.\" .nh        disable hyphenation
.\" .hy        enable hyphenation
.\" .ad l      left justify
.\" .ad b      justify to both left and right margins
.\" .nf        disable filling
.\" .fi        enable filling
.\" .br        insert line break
.\" .sp <n>    insert n+1 empty lines
.\" for manpage-specific macros, see man(7)
.SH NAME
omd \- admin interface for OMD, the Open Monitoring Distribution
.SH SYNOPSIS
.B omd
.RI [ command 
.RI [ site... ] 
.RI ]
.SH DESCRIPTION
.B OMD - the Open Monitoring Distribution
is something really new. OMD bundles existing open source software to 
ease the installation procedure of Nagios and many important addons 
like NagVis, PNP4Nagios, rrdtool, nagios-plugins, Check_MK, 
MK Livestatus, Dokuwiki, NSCA, check_nrpe and others.

.B OMD
supports:

- multiple versions of OMD installed in parallel
.br
- multiple instances of Nagios running in parallel (so called "sites")

.PP
.\" TeX users may be more comfortable with the \fB<whatever>\fP and
.\" \fI<whatever>\fP escape sequences to invode bold face and italics,
.\" respectively.
\fBomd\fP is the administration interface for creating and maintaining 
sites within OMD - the open monitoring distribution.
.SH COMMANDS
.TP
.B omd help
Show short summary of available commands.
.TP
.B omd version
Show the default version of you OMD installation. OMD supports
multiple versions to be installed in parallel.
.TP
.B omd versions                    
Show a list of all installed versions of OMD.
.TP
.B omd setup                       
Prepare operating system for OMD. This includes installing all software
packages from your linux distribution that the components of OMD need
to run properly. You need to make sure that a package installation via
aptitude/zypper/yum is possible.

After installing missing packages a group \fBomd\fP will be created,
some Apache modules will be activated, the init script \fB/etc/init.d/omd\fP
will be activated and the SUID bits for some Nagios plugins will be
correctly configured (for the group omd).

\fBNote:\fP If you have installed OMD via RPM or DEB and have installed
all packages the omd package depends on, no \fBomd setup\fP is neccessary.
.TP
.B omd uninstall                   
This deletes all software and data of OMD and its sites. That command is mainly used
for trying out OMD or testing the installation of OMD. Be aware that
all your monitoring configuration and data will be lost!

Note: Do not use \fBomd uninstall\fP if you've installed omd via RPM or DEB.
Better remove all sites via by using \fBomd rm\fP and remove the RPM/DEB
package afterwards.
.TP
.B omd sites                       
Show a list of all sites and the version of OMD each site uses.
.TP
.B omd create     SITE             
Create a new site. The name of the site must be at most 16 characters
long and consist only of letters, digits and underscores. It must not
begin with a digit. 

OMD creates an operating system user and group with the name of the
site. No user or group with that name must exist prior to the site creation. Then a 
directory \fB/omd/sites/\fPSITE will be created and used as the new
user's home directory.

You need root permissions for creating a new site.

After creating a new site you can do a \fBsu - \fPSITE and start
the site with \fBomd start\fP.
.TP
.B omd rm         SITE             
Remove a site and all of its data. This includes deleting the
directory \fB/omd/sites/\fPSITE and removing the system user
and group of that site. This - of course - needs root permissions.
.TP
.B omd mv         SITE NEWNAME     
Rename a site. The site must be stopped. the NEWNAME must be a valid
site name as described in "omd create". Root permissions are needed.
.TP
.B omd cp [OPTIONS] SITE NEWNAME     
Make a copy of a site. A new site with the name NEWSITE will be created
as an exact copy of SITE. All occurrances of SITE will be replaced by 
NEWSITE in the sites configuration files.

The following options can be used:

\fB-u UID\fP Force a specific user id for the new user

\fB-g GID\fP Force a specific group id for the group of the new user

\fB--no-rrds\fP Do not copy any performance data from the past. This
includes RRD and XML files created by PNP4Nagios as well as journal
files from the RRD caching daemon. This option usually greatly speeds
up the copying.

\fB--no-logs\fP Do not copy any logfiles from the past. This
include the Nagios logfiles, which bear the historical events. While
this does speed up the copying, the new site will have no history
of past events.

The option \fB-N\fP or \fB--no-past\fP combines both \fB--no-rrds\fP and \fB--no-logs\fP.
This is very useful especially for copies that are created for testing
purposes.

.TP
.B omd update     SITE             
Update SITE to the current default version of OMD. The default version
is usually the version that was installed most lately. The sites configuration
files will be updated as well. OMD tries hard to merge your changes with
changes due to the new version but might need your help in doing so.
.TP
.B omd start      [SITE] [SERVICE]
Start a site, i.e. start all activated daemons and services of a site. 
If you call this as root, you need to specify the site to
be started. If you do not specify a site, then all sites with AUTOSTART=on
will be started. If you call this as site user, no site must be specified.
The current site will be started.

If you add the name of a service, e.g. \fBnagios\fP, then only that
service is being started. If being called as root, a service can only
be specified if also a site is specified.
.TP
.B omd stop       [SITE] [SERVICE]
Stop a site. See \fBomd start\fP for details. This stops also sites where
AUTOSTART=off.
.TP
.B omd restart    [SITE] [SERVICE]
Restart site. See \fBomd start\fP for details.
.TP
.B omd reload     [SITE] [SERVICE]
Reload services of site(s). That is the same as calling all of the sites
init scripts with the option \fBreload\fP. Refer to \fBomd start\fP for
how to specify sites.
.TP
.B omd status     [SITE] [SERVICE]
Show status of site(s). Refer to \fBomd start\fP for
how to specify sites.
.TP
.B omd config     [SITE] [set|show] [VARIABLE] [VALUE]
This command is used to view and change the configuration of a site. Each
site has a list of configuration variables. Those variables configure
how the addons of the site should work together. Optional addons can be
switched on and off. TCP portnumbers for externel access can be configured.

\fBomd config\fP [SITE] \fBshow\fP outputs the current settings of
all variables of a SITE. If you call this as root, you have to specify
which SITE to inspect. If you call \fBomd\fP as site user, you have to
leave out SITE.

\fBomd config\fP [SITE] brings you into the interactive configuration
mode where variables can be viewed, are explained and can be changed.
The site must be stopped for configuration changes.

Setting and querying variables in batch mode can be done with

\fBomd config [SITE] set VARIABLE VALUE\fP
.br
\fBomd config [SITE] get VARIABLE\fP
.SH SEE ALSO
.BR http://www.omdistro.org
.br
.SH AUTHOR
omd was written by Mathias Kettner <mk@mathias-kettner.de>.
See /usr/share/doc/omd/TEAM for contributors to omd.
