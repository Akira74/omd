include ../../Makefile.omd

NAME = rrdtool
VERSION = 1.4.4
DIR = $(NAME)-$(VERSION)

CONFIGUREOPTS = \
    --prefix=$(OMD_ROOT) \
	--disable-ruby \
	--disable-python

build:
	tar xzf $(DIR).tar.gz
	# The man pages of the bindings (RRDp and RRDs are installed
	# in share/man/man3 but should be installed to man/man3 in our
	# environment. So apply this patch to Makefile.PL to set the
	# correct paths in the Makefile which will be generated by the
	# configure script.
	cd $(DIR) && \
	patch bindings/perl-shared/Makefile.PL < ../fix-shared-bindings-man-path.patch && \
	patch bindings/perl-piped/Makefile.PL < ../fix-piped-bindings-man-path.patch && \
	./configure $(CONFIGUREOPTS)
	$(MAKE) -C $(DIR) all

install:
	$(MAKE) DESTDIR=$(DESTDIR) -C $(DIR) install
	
	mkdir $(DESTDIR)$(OMD_ROOT)/share/doc/rrdtool
	install -m 644 $(DIR)/README $(DESTDIR)$(OMD_ROOT)/share/doc/rrdtool
	install -m 644 $(DIR)/COPYING $(DESTDIR)$(OMD_ROOT)/share/doc/rrdtool
	install -m 644 $(DIR)/COPYRIGHT $(DESTDIR)$(OMD_ROOT)/share/doc/rrdtool
	install -m 644 $(DIR)/CONTRIBUTORS $(DESTDIR)$(OMD_ROOT)/share/doc/rrdtool

skel:

clean:
	rm -rf $(DIR)
